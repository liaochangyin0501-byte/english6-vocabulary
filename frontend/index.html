<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­å…­çº§è¯æ±‡ç»ƒä¹ </title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        header { background: #4a5568; color: white; padding: 30px; text-align: center; }
        header h1 { font-size: 2.2rem; margin-bottom: 10px; }
        .quiz-area { padding: 30px; }
        .word-card { background: #f7fafc; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; }
        #english-word { font-size: 3.5rem; color: #2d3748; font-weight: bold; margin: 20px 0; }
        .phonetic { color: #718096; font-size: 1.5rem; margin-bottom: 30px; }
        .options { display: grid; gap: 15px; margin: 30px 0; }
        .option { padding: 20px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-size: 1.1rem; }
        .option:hover { border-color: #667eea; background: #f0f4ff; }
        .controls { display: flex; justify-content: center; gap: 15px; margin-top: 30px; }
        button { padding: 15px 35px; border: none; border-radius: 10px; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
        #next-btn { background: #48bb78; color: white; }
        #hint-btn { background: #ed8936; color: white; }
        #submit-btn { background: #667eea; color: white; }
        .hidden { display: none; }
        .feedback { padding: 20px; margin-top: 20px; border-radius: 10px; }
        .correct { background: #c6f6d5; color: #22543d; }
        .wrong { background: #fed7d7; color: #742a2a; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š è‹±è¯­å…­çº§æ ¸å¿ƒè¯æ±‡ç»ƒä¹ </h1>
            <p>å·²æŒæ¡ <span id="score">0</span> ä¸ªå•è¯ | æ­£ç¡®ç‡: <span id="accuracy">0%</span></p>
        </header>
        
        <main class="quiz-area">
            <div class="word-card">
                <h2 id="english-word">Loading...</h2>
                <div class="phonetic" id="phonetic">/lÉ™ÊŠdÉªÅ‹/</div>
                <p>è¯·é€‰æ‹©è¯¥å•è¯çš„æ­£ç¡®ä¸­æ–‡é‡Šä¹‰ï¼š</p>
                
                <div class="options" id="options-container">
                    <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="controls">
                    <button id="hint-btn">ğŸ’¡ æç¤º</button>
                    <button id="submit-btn" class="hidden">âœ… æäº¤ç­”æ¡ˆ</button>
                    <button id="next-btn">â­ï¸ ä¸‹ä¸€é¢˜</button>
                </div>
                
                <div id="feedback" class="feedback hidden"></div>
            </div>
            
            <div style="text-align: center; color: #718096; margin-top: 40px;">
                <p>å½“å‰æ¨¡å¼ï¼šé€‰æ‹©é¢˜ | å•è¯æ€»æ•°: <span id="total-words">5</span> | æœåŠ¡å™¨çŠ¶æ€: <span id="server-status">ğŸ”´ æ£€æµ‹ä¸­...</span></p>
            </div>
        </main>
    </div>

    <script>
        const API_BASE_URL = 'https://english6-vocabulary.onrender.com/api';
        let currentWordIndex = 0;
        let allWords = [];
        let score = 0;
        let totalAnswered = 0;
        let selectedOption = null;

        // ========== DOMå…ƒç´  ==========
        const elements = {
            englishWord: document.getElementById('english-word'),
            phonetic: document.getElementById('phonetic'),
            optionsContainer: document.getElementById('options-container'),
            submitBtn: document.getElementById('submit-btn'),
            nextBtn: document.getElementById('next-btn'),
            hintBtn: document.getElementById('hint-btn'),
            feedback: document.getElementById('feedback'),
            score: document.getElementById('score'),
            accuracy: document.getElementById('accuracy'),
            totalWords: document.getElementById('total-words'),
            serverStatus: document.getElementById('server-status')
        };

        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            // æµ‹è¯•æœåŠ¡å™¨è¿æ¥
            try {
                const testRes = await fetch(`${API_BASE_URL}/hello`);
                if (testRes.ok) {
                    elements.serverStatus.innerHTML = 'ğŸŸ¢ å·²è¿æ¥';
                    elements.serverStatus.style.color = '#38a169';
                }
            } catch (error) {
                elements.serverStatus.innerHTML = 'ğŸ”´ è¿æ¥å¤±è´¥';
                elements.serverStatus.style.color = '#e53e3e';
                alert('åç«¯æœåŠ¡å™¨æœªå¯åŠ¨ï¼è¯·ç¡®ä¿å·²è¿è¡Œ node server.js');
                return;
            }
            
            // åŠ è½½è¯æ±‡æ•°æ®
            await loadWords();
            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            loadQuestion();
        });

        // ========== æ ¸å¿ƒå‡½æ•° ==========
        async function loadWords() {
            try {
                const response = await fetch(`${API_BASE_URL}/words`);
                const data = await response.json();
                if (data.success) {
                    allWords = data.data;
                    elements.totalWords.textContent = allWords.length;
                    console.log(`âœ… åŠ è½½äº† ${allWords.length} ä¸ªå•è¯`);
                }
            } catch (error) {
                console.error('åŠ è½½è¯æ±‡å¤±è´¥:', error);
                // ä½¿ç”¨å¤‡ç”¨æ•°æ®
                allWords = [
                    { id: 1, word: "abandon", phonetic: "/É™ËˆbÃ¦ndÉ™n/", meaning: "æ”¾å¼ƒï¼Œé—å¼ƒ" },
                    { id: 2, word: "accommodate", phonetic: "/É™ËˆkÉ’mÉ™deÉªt/", meaning: "å®¹çº³ï¼Œæä¾›ä½å®¿" }
                ];
                elements.totalWords.textContent = allWords.length;
            }
        }

        function loadQuestion() {
            if (allWords.length === 0) {
                elements.englishWord.textContent = "æš‚æ— æ•°æ®";
                return;
            }
            
            const word = allWords[currentWordIndex];
            elements.englishWord.textContent = word.word;
            elements.phonetic.textContent = word.phonetic;
            
            // ç”Ÿæˆé€‰é¡¹
            generateOptions(word);
            
            // é‡ç½®çŠ¶æ€
            selectedOption = null;
            elements.submitBtn.classList.add('hidden');
            elements.nextBtn.textContent = 'â­ï¸ ä¸‹ä¸€é¢˜';
            elements.feedback.classList.add('hidden');
            
            updateStats();
        }

        function generateOptions(correctWord) {
            elements.optionsContainer.innerHTML = '';
            
            // æ”¶é›†æ‰€æœ‰é”™è¯¯é€‰é¡¹
            const wrongOptions = allWords
                .filter(w => w.id !== correctWord.id)
                .map(w => w.meaning)
                .slice(0, 3); // å–3ä¸ª
            
            // åˆ›å»ºé€‰é¡¹æ•°ç»„ (1æ­£ç¡® + 3é”™è¯¯)
            const options = [
                { text: correctWord.meaning, isCorrect: true },
                ...wrongOptions.map(text => ({ text, isCorrect: false }))
            ];
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            shuffleArray(options);
            
            // åˆ›å»ºé€‰é¡¹å…ƒç´ 
            options.forEach((option, index) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                optionEl.innerHTML = `
                    <span style="font-weight: bold; margin-right: 10px;">${String.fromCharCode(65 + index)}.</span>
                    <span>${option.text}</span>
                `;
                
                optionEl.addEventListener('click', () => {
                    // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
                    document.querySelectorAll('.option').forEach(el => {
                        el.style.borderColor = '#e2e8f0';
                        el.style.background = 'white';
                    });
                    
                    // æ ‡è®°å½“å‰é€‰æ‹©
                    optionEl.style.borderColor = '#667eea';
                    optionEl.style.background = '#ebf8ff';
                    selectedOption = option;
                    
                    // æ˜¾ç¤ºæäº¤æŒ‰é’®
                    elements.submitBtn.classList.remove('hidden');
                });
                
                elements.optionsContainer.appendChild(optionEl);
            });
        }

        async function submitAnswer() {
            if (!selectedOption) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                return;
            }
            
            const currentWord = allWords[currentWordIndex];
            const isCorrect = selectedOption.isCorrect;
            
            // æ˜¾ç¤ºåé¦ˆ
            elements.feedback.classList.remove('hidden');
            elements.feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
            elements.feedback.innerHTML = isCorrect 
                ? `âœ… <strong>å›ç­”æ­£ç¡®ï¼</strong> ${currentWord.word} çš„æ„æ€æ˜¯ "${currentWord.meaning}"`
                : `âŒ <strong>å›ç­”é”™è¯¯ã€‚</strong> æ­£ç¡®ç­”æ¡ˆæ˜¯: "${currentWord.meaning}"`;
            
            // æ›´æ–°åˆ†æ•°
            if (isCorrect) score++;
            totalAnswered++;
            
            // ç¦ç”¨é€‰é¡¹ç‚¹å‡»
            document.querySelectorAll('.option').forEach(el => {
                el.style.pointerEvents = 'none';
            });
            
            // æ›´æ–°æŒ‰é’®
            elements.submitBtn.classList.add('hidden');
            elements.nextBtn.textContent = 'â­ï¸ ç»§ç»­';
            
            updateStats();
        }

        function nextQuestion() {
            currentWordIndex = (currentWordIndex + 1) % allWords.length;
            loadQuestion();
        }

        function showHint() {
            const word = allWords[currentWordIndex];
            alert(`ğŸ’¡ æç¤ºï¼š\nå•è¯: ${word.word}\nå­—æ¯æ•°: ${word.word.length}\nå¼€å¤´å­—æ¯: ${word.word[0].toUpperCase()}`);
        }

        function updateStats() {
            elements.score.textContent = score;
            const accuracy = totalAnswered > 0 ? Math.round((score / totalAnswered) * 100) : 0;
            elements.accuracy.textContent = `${accuracy}%`;
        }

        // ========== å·¥å…·å‡½æ•° ==========
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // ========== äº‹ä»¶ç›‘å¬ ==========
        elements.submitBtn.addEventListener('click', submitAnswer);
        elements.nextBtn.addEventListener('click', nextQuestion);
        elements.hintBtn.addEventListener('click', showHint);
    </script>
</body>
</html>